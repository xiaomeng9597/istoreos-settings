#!/bin/sh

. /etc/os-release
. /lib/functions/uci-defaults.sh

# 设置默认主题为argon
uci set luci.main.mediaurlbase='/luci-static/argon'
uci commit luci

# 默认wan口防火墙打开
#uci set firewall.@zone[1].input='ACCEPT'
#uci commit firewall

# 设置所有网口可访问网页终端
#uci delete ttyd.@ttyd[0].interface

# 设置所有网口可连接 SSH
#uci set dropbear.@dropbear[0].Interface=''
#uci commit

# 设置主机名映射，解决安卓原生TV首次连不上网的问题
uci add dhcp domain
uci set "dhcp.@domain[-1].name=time.android.com"
uci set "dhcp.@domain[-1].ip=203.107.6.88"
uci commit dhcp

# Docker换源
if [ -f /etc/config/dockerd ] && [ $(grep -c daocloud.io /etc/config/dockerd) -eq '0' ]; then
    uci add_list dockerd.globals.registry_mirrors="https://docker.m.daocloud.io"
    uci commit dockerd
fi

# 设置NTP服务器
uci -q batch <<-EOF
	set system.@system[0].hostname='iStoreOS'
	set system.@system[0].timezone='CST-8'
	set system.@system[0].zonename='Asia/Shanghai'

	delete system.ntp.server
	add_list system.ntp.server='ntp1.aliyun.com'
	add_list system.ntp.server='ntp.tencent.com'
	add_list system.ntp.server='ntp.ntsc.ac.cn'
	add_list system.ntp.server='time.apple.com'
EOF
uci commit system

# diagnostics
uci set luci.diag.ping='www.qq.com'
uci set luci.diag.route='www.qq.com'
uci set luci.diag.dns='www.qq.com'
uci commit luci

exit 0
